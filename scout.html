<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Scout ‚Äì TheCricketBoss</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles/global.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #1e1b3a;
      color: white;
    }

    .main {
      padding-top: 80px;
      padding-bottom: 90px;
      max-width: 600px;
      margin: 0 auto;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #fff;
    }

    #scout-btn {
      display: block;
      margin: 0 auto 16px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #00e676;
      color: #000;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #scout-btn:disabled {
      background-color: #777;
      color: #ccc;
      cursor: not-allowed;
    }

    #countdown {
      text-align: center;
      margin-bottom: 20px;
      font-size: 14px;
      color: #bbb;
    }

    #player-card {
      display: none;
      background: #2d2a4a;
      border-radius: 12px;
      padding: 16px;
      margin: 0 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      color: white;
      text-align: center;
      transition: all 0.5s ease;
    }

    #player-card.reveal {
      display: block;
    }

    #player-card img {
      height: 110px;
      border-radius: 8px;
      margin-bottom: 10px;
      border: 2px solid #00e676;
    }

    .label {
      font-size: 13px;
      margin: 8px 0 4px;
      text-align: left;
    }

    .stat-bar {
      background: #444;
      height: 10px;
      border-radius: 6px;
      overflow: hidden;
      position: relative;
    }

    .stat-bar-inner {
      position: absolute;
      height: 100%;
      width: 0%;
      transition: width 0.7s ease;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="main">
    <h2>üß≠ Scout New Talent</h2>

    <button id="scout-btn">Scout Player</button>
    <div id="countdown"></div>

    <div id="player-card">
      <img id="player-img" src="" alt="Player Image" />
      <h3 id="player-name"></h3>
      <p id="player-role"></p>
      <p id="player-age"></p>
      <p id="player-skill"></p>

      <div class="label">Batting</div>
      <div class="stat-bar"><div id="bar-batting" class="stat-bar-inner" style="background: #00e676;"></div></div>

      <div class="label">Bowling</div>
      <div class="stat-bar"><div id="bar-bowling" class="stat-bar-inner" style="background: #00bcd4;"></div></div>

      <div class="label">Keeping</div>
      <div class="stat-bar"><div id="bar-keeping" class="stat-bar-inner" style="background: #ff9800;"></div></div>

      <div class="label">Fitness</div>
      <div class="stat-bar"><div id="bar-fitness" class="stat-bar-inner" style="background: #8e24aa;"></div></div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    import { loadSharedUI, addManagerXP } from "./js/shared-ui.js";

    const supabase = createClient(
      "https://iukofcmatlfhfwcechdq.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1a29mY21hdGxmaGZ3Y2VjaGRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM0NTczODQsImV4cCI6MjA2OTAzMzM4NH0.XMiE0OuLOQTlYnQoPSxwxjT3qYKzINnG6xq8f8Tb_IE"
    );

    const { data: { user } } = await supabase.auth.getUser();
    if (!user) window.location.href = "login.html";

    const { data: profile } = await supabase
      .from("profiles")
      .select("*")
      .eq("user_id", user.id)
      .single();

    if (!profile || !profile.manager_name) {
      window.location.href = "profile-setup.html";
    }

    loadSharedUI({
      manager_name: profile.manager_name,
      xp: profile.xp,
      coins: profile.coins,
      cash: profile.cash
    });

    const scoutBtn = document.getElementById("scout-btn");
    const countdown = document.getElementById("countdown");

    // Check if today is Wednesday
    const today = new Date();
    const isWednesday = today.getDay() === 3;

    if (!isWednesday) {
      scoutBtn.disabled = true;
      countdown.textContent = "‚õî Our Scouting Team searching for best young talent, they will be reach here with New Talent on WEDNESDAY. So stay tuned and comeback here on WEDNESDAY to meet your New Player. üß≠";
    }

    // Prevent double scout on same day
    const todayDate = today.toISOString().split("T")[0];
    if (profile.last_scout_date === todayDate) {
      scoutBtn.disabled = true;
      countdown.textContent = "‚úÖ You already scouted a player today.";
    }

    scoutBtn.addEventListener("click", async () => {
      scoutBtn.disabled = true;
      countdown.textContent = "Scouting...";

      // Generate player data (randomized ‚Äî customize as needed)
      const player = {
        name: "Random Player",
        role: "All-Rounder",
        batting: Math.floor(Math.random() * 16),
        bowling: Math.floor(Math.random() * 16),
        keeping: Math.floor(Math.random() * 16),
        fitness: Math.floor(Math.random() * 16),
        age_years: 16 + Math.floor(Math.random() * 5),
        age_days: 0,
        team_id: profile.team_id
      };

      const { error } = await supabase
        .from("players")
        .insert([player]);

      if (!error) {
        // ‚úÖ Give XP
        await addManagerXP(user.id, "scout_player");

        // ‚úÖ Update scout date
        await supabase
          .from("profiles")
          .update({ last_scout_date: todayDate })
          .eq("user_id", user.id);

        // UI reveal (use your existing card code here)
        document.getElementById("player-card").classList.add("reveal");
        document.getElementById("player-img").src = "assets/player-default.png";
        document.getElementById("player-name").textContent = player.name;
        document.getElementById("player-role").textContent = player.role;
        document.getElementById("player-age").textContent = `Age: ${player.age_years}`;
        document.getElementById("player-skill").textContent = "Skill Level: Newbie";

        document.getElementById("bar-batting").style.width = `${player.batting * 5}%`;
        document.getElementById("bar-bowling").style.width = `${player.bowling * 5}%`;
        document.getElementById("bar-keeping").style.width = `${player.keeping * 5}%`;
        document.getElementById("bar-fitness").style.width = `${player.fitness * 5}%`;

        countdown.textContent = "‚úÖ Player scouted and added to your team. +10 XP";
      } else {
        countdown.textContent = "‚ùå Scout failed. Try again.";
        scoutBtn.disabled = false;
      }
    });
  </script>
</body>
</html>



