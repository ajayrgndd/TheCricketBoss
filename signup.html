<!DOCTYPE html>
<html>
<head>
  <title>TheCricketBoss - Signup</title>
</head>
<body>
  <h2>Register to TheCricketBoss</h2>

  <form id="signup-form">
    <input type="text" id="managerName" placeholder="Manager Name (unchangeable)" required /><br><br>
    <input type="text" id="teamName" placeholder="Team Name (unchangeable & unique)" required /><br><br>
    <label for="dob">Date of Birth:</label><br>
    <input type="date" id="dob" required /><br><br>

    <label for="region">Select Region:</label><br>
    <select id="region" required>
      <option value="">-- Select Region --</option>
      <optgroup label="India - States">
        <option>Andhra Pradesh</option>
        <option>Arunachal Pradesh</option>
        <option>Assam</option>
        <option>Bihar</option>
        <option>Chhattisgarh</option>
        <option>Goa</option>
        <option>Gujarat</option>
        <option>Haryana</option>
        <option>Himachal Pradesh</option>
        <option>Jharkhand</option>
        <option>Karnataka</option>
        <option>Kerala</option>
        <option>Madhya Pradesh</option>
        <option>Maharashtra</option>
        <option>Manipur</option>
        <option>Meghalaya</option>
        <option>Mizoram</option>
        <option>Nagaland</option>
        <option>Odisha</option>
        <option>Punjab</option>
        <option>Rajasthan</option>
        <option>Sikkim</option>
        <option>Tamil Nadu</option>
        <option>Telangana</option>
        <option>Tripura</option>
        <option>Uttar Pradesh</option>
        <option>Uttarakhand</option>
        <option>West Bengal</option>
      </optgroup>
      <optgroup label="India - Union Territories">
        <option>Andaman and Nicobar Islands</option>
        <option>Chandigarh</option>
        <option>Dadra and Nagar Haveli and Daman and Diu</option>
        <option>Delhi</option>
        <option>Jammu and Kashmir</option>
        <option>Ladakh</option>
        <option>Lakshadweep</option>
        <option>Puducherry</option>
      </optgroup>
      <optgroup label="Top Cricket Nations (excluding India)">
        <option>Australia</option>
        <option>Bangladesh</option>
        <option>England</option>
        <option>New Zealand</option>
        <option>Pakistan</option>
        <option>South Africa</option>
        <option>Sri Lanka</option>
        <option>Afghanistan</option>
        <option>West Indies</option>
        <option>Zimbabwe</option>
        <option>Ireland</option>
        <option>Netherlands</option>
        <option>Scotland</option>
        <option>Namibia</option>
        <option>UAE</option>
        <option>USA</option>
        <option>Oman</option>
        <option>Nepal</option>
      </optgroup>
    </select><br><br>

    <input type="email" id="email" placeholder="Email" required /><br><br>
    <input type="password" id="password" placeholder="Password" required /><br><br>

    <button type="submit">Sign Up</button>
  </form>

  <p id="status"></p>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://ejcutfzguoqnkrparcox.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqY3V0ZnpndW9xbmtycGFyY294Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDEyODc3NzgsImV4cCI6MTczMjgyMzc3OH0.kmqbM7T8RyZmSBhv50U9MyUVbixgYfVRg4sctVwcbMk'
    );

    const form = document.getElementById("signup-form");
    const status = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const managerName = document.getElementById("managerName").value.trim();
      const teamName = document.getElementById("teamName").value.trim();
      const dob = document.getElementById("dob").value;
      const region = document.getElementById("region").value;
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      if (!managerName || !teamName || !dob || !region || !email || !password) {
        status.textContent = "Please fill all fields.";
        return;
      }

      // Check if team name is already taken
      const { data: existingTeam, error: teamError } = await supabase
        .from("users")
        .select("team_name")
        .eq("team_name", teamName);

      if (existingTeam && existingTeam.length > 0) {
        status.textContent = "Team name already exists. Choose a different name.";
        return;
      }

      // Proceed with signup
      const { data, error: signUpError } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: {
            manager_name: managerName,
            team_name: teamName,
            dob,
            region,
            manager_level: "Beginner"
          },
          emailRedirectTo: "https://thecricketboss.netlify.app/confirm.html"
        }
      });

      if (signUpError) {
        status.textContent = "Signup failed: " + signUpError.message;
      } else {
        status.textContent = "Check your email to confirm your account.";
        form.reset();
      }
    });
  </script>
</body>
</html>
