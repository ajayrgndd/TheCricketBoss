<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Match Replay ‚Äì TheCricketBoss</title>
<link rel="stylesheet" href="styles/global.css">
<style>
#log {
  height: 300px;
  overflow-y: auto;
  background: #222;
  color: #fff;
  padding: 10px;
  font-family: monospace;
}
</style>
</head>
<body>
<h1>Match Replay</h1>
<div id="log"></div>
<button id="playBtn">‚ñ∂ Play Replay</button>

<script type="module">
import { supabase } from './supabaseClient.js';

const params = new URLSearchParams(window.location.search);
const matchId = params.get('id');
let events = [];

async function fetchEvents() {
    const { data, error } = await supabase
        .from('match_events')
        .select('*')
        .eq('match_id', matchId)
        .order('ball_number', { ascending: true });
    if (error) console.error(error);
    events = data;
}

document.getElementById('playBtn').addEventListener('click', async () => {
    await fetchEvents();
    const log = document.getElementById('log');
    log.innerHTML = "";
    let i = 0;
    const interval = setInterval(() => {
        if (i >= events.length) {
            clearInterval(interval);
            log.innerHTML += "<br>üèÜ Match Finished!";
            return;
        }
        log.innerHTML += events[i].description + "<br>";
        log.scrollTop = log.scrollHeight;
        i++;
    }, 1000); // 1 second per ball
});
</script>
</body>
</html>
